# TG支付机器人

TG支付机器人是一个基于 **PHP + MySQL + Telegram Bot API** 开发的个人支付解决方案，支持接入**易支付接口**，实现微信、支付宝收款，配套**网页管理后台**进行订单管理和配置操作。

---

## ✅ 功能概览

- **一键配置安装**：访问安装页面填写配置信息，自动创建数据库表并生成配置文件。
- **Telegram机器人核心逻辑**：
  - `/start`：展示支付引导信息，引导用户开始支付流程；
  - 用户点击按钮后输入金额，选择支付方式（支付宝/微信）；
  - `/pay 金额`：直接生成订单，展示二维码或跳转链接；
  - `/login`：仅限主人获取一次性后台登录链接。
- **易支付接口对接**：
  - 支持支付宝、微信；
  - 使用 MD5 签名验证；
  - 自动生成支付二维码或跳转链接。
- **二维码展示**：调用二维码 API，自动生成并发送支付二维码图片。
- **网页后台管理**：
  - 使用 Layui 界面；
  - 管理订单记录、配置易支付接口。

---

## 🧾 使用说明

### ✅ 用户支付流程演示

1. **发送 `/start` 指令**

   用户发送 `/start`，机器人将返回支付说明及引导按钮。

   ![step1](./d161badd-c765-42a1-823c-df221382d857.png)

2. **输入金额后创建订单**

   用户输入金额后，机器人生成支付订单并提供支付方式选择按钮。

   ![step2](./eb06addf-9c67-4f68-9777-d0af0115a3d2.png)

3. **选择支付方式并获取二维码**

   用户选择支付宝或微信后，机器人展示支付二维码、订单信息及跳转按钮。

   ![step3](./13464023-f688-458c-95f7-ac53c22f446c.png)

---

## 🔐 后台管理

- 主人可发送 `/login` 指令获取一次性后台登录链接；
- 后台功能包括：
  - 查看订单记录；
  - 设置易支付参数（商户ID、密钥、通知地址）；
  - 系统配置管理。

---

## ⚙️ 安装与部署

1. **环境要求**
   - PHP 7.2+（建议 7.4+）
   - MySQL 5.7+
   - Redis（可选，用于缓存）
   - Nginx 或 Apache

2. **上传代码**
   - 将完整项目上传至服务器网站目录。

3. **访问安装页面**
   - 打开 `config_install.php`，填写数据库、Redis、TG Token、主人ID、站点域名等，完成初始化配置。

4. **配置易支付**
   - 登录后台，进入 `admin/easypay_config.php` 设置接口参数。

5. **启动机器人**
   - 推荐使用宝塔面板 `supervisord` 后台运行：
     ```
     /www/server/php/74/bin/php /www/wwwroot/项目路径/bot.php
     ```

---

## 🔗 第三方依赖

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Layui](https://www.layui.com/)
- [易支付接口](#)（需根据服务商提供的接口文档配置）
- 二维码服务：`https://api.qrserver.com/v1/create-qr-code/`

---

## ⚠️ 注意事项

- 请确保易支付接口配置（商户ID、密钥）与平台后台一致；
- Telegram Bot 使用需在 **私聊或具有管理权限的群组**中；
- 如有大并发需求，建议部署本地二维码生成服务替代第三方API。

---

## 📄 开源协议

本项目使用 **MIT License**，可自由修改、二次开发，详见 [LICENSE](LICENSE)。

---

欢迎提交 Issue 或 Pull Request，感谢您的使用与支持！
